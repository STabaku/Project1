<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register - 24/7 Emergency Pharmacy</title>
  <link rel="stylesheet" href="auth.css">
</head>
<body>

<header class="navbar-auth">
  <div class="wrap">
    <a href="index.html" aria-label="Home">
      <img src="assets/logo.png" class="logo-img" alt="24/7 Emergency Pharmacy Logo">
    </a>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="login.html">Login</a>
      <a href="#">Help</a>
    </nav>
  </div>
</header>

<section class="auth-hero">
  <div class="wrap">
    <div>
      <h1>Register</h1>
    </div>

    <div class="card-auth">
  <h2>Create Account</h2>

  <div class="field">
    <label>First Name</label>
    <input id="firstName" placeholder="e.g. Anna">
  </div>

  <div class="field">
    <label>Last Name</label>
    <input id="lastName" placeholder="e.g. Smith">
  </div>

  <div class="field">
    <label>Email</label>
    <input id="email" type="email" placeholder="email@domain.com">
  </div>
   <div class="field">
    <label>Number</label>
    <input id="number" type="number" placeholder="">
  </div>

  <div class="field">
    <label>Password</label>
    <input id="password" type="password" placeholder="********">
  </div>

  <button class="btn btn-primary" id="btnRegister">Register</button>

  <div class="notice ok" id="ok"></div>
  <div class="notice err" id="err"></div>

  <div class="help">
    Already have an account? <a href="login.html">Login</a>
  </div>
</div>

  </div>
</section>

<script>
const API = "http://localhost:5183/api/auth";

const qs = id => document.getElementById(id);
const show = (el, msg) => { el.textContent = msg; el.style.display = "block"; };
const hide = el => { el.textContent = ""; el.style.display = "none"; };

async function register() {
  hide(qs("ok"));
  hide(qs("err"));

  const firstName = qs("firstName").value.trim();
  const lastName = qs("lastName").value.trim();
  const email = qs("email").value.trim();
    const number = qs("number").value.trim();
  const password = qs("password").value;

  if (!firstName || !lastName || !email || !number || !password) {
    show(qs("err"), "All fields are required");
    return;
  }

  const payload = {
    name: firstName + " " + lastName,
    email: email,
    number: number,
    password: password,
    role: "User",
    pharmacyId: null
  };

  try {
    const res = await fetch(API + "/signup", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const text = await res.text();

    if (!res.ok) {
      show(qs("err"), text);
      return;
    }

    show(qs("ok"), "Account created successfully. Redirecting to login...");

    setTimeout(() => {
      window.location.href = "login.html";
    }, 1000);

  } catch (e) {
    show(qs("err"), "Cannot connect to server");
  }
}

qs("btnRegister").addEventListener("click", register);
</script>

</body>
</html>
