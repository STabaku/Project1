<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pharmacy Dashboard</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4f6f9;
  display: flex;
}

/* SIDEBAR */
.sidebar {
  width: 240px;
  background: #1e293b;
  color: white;
  height: 100vh;
  padding: 20px;
}

.sidebar h2 {
  margin-bottom: 30px;
  text-align: center;
}

.sidebar a {
  display: block;
  padding: 12px;
  color: white;
  text-decoration: none;
  border-radius: 6px;
  margin-bottom: 8px;
}

.sidebar a:hover {
  background: #334155;
}

/* MAIN */
.main {
  flex: 1;
  padding: 30px;
}

.topbar {
  display: flex;
  justify-content: space-between;
  margin-bottom: 30px;
}

.card-box {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.05);
  text-align: center;
}

.card h3 {
  margin: 0;
  font-size: 26px;
}

.section {
  background: white;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 30px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

table th, table td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
  text-align: center;
}

.status-pending { color: orange; font-weight: bold; }
.status-accepted { color: green; font-weight: bold; }
.status-delivered { color: blue; font-weight: bold; }

.btn {
  padding: 6px 12px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.btn-accept { background: #16a34a; color: white; }
.btn-done { background: #2563eb; color: white; }
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <h2>Pharmacy Panel</h2>
  <a href="#" onclick="showSection('overview')">Dashboard</a>
  <a href="#" onclick="showSection('new')">New Requests</a>
  <a href="#" onclick="showSection('active')">Active Orders</a>
  <a href="#" onclick="showSection('history')">History</a>
  <a href="#" onclick="showSection('profile')">Profile</a>
  <a href="#" onclick="logout()">Logout</a>
</div>

<!-- MAIN -->
<div class="main">

  <!-- TOP BAR -->
  <div class="topbar">
    <h2 id="pharmacyName">City Pharmacy Dashboard</h2>
    <span id="pharmacyEmail">city@pharmacy.com</span>
  </div>

  <!-- OVERVIEW -->
  <div id="overview" class="section">
    <h3>Overview</h3>
    <div class="card-box">
      <div class="card"><h3 id="totalReq">0</h3><p>Total Requests</p></div>
      <div class="card"><h3 id="pendingReq">0</h3><p>Pending</p></div>
      <div class="card"><h3 id="activeReq">0</h3><p>Active</p></div>
      <div class="card"><h3 id="doneReq">0</h3><p>Delivered</p></div>
    </div>
  </div>

  <!-- NEW REQUESTS -->
  <div id="new" class="section" style="display:none;">
    <h3>New Emergency Requests</h3>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Medicine</th>
          <th>Qty</th>
          <th>Address</th>
          <th>Time</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="newRequests"></tbody>
    </table>
  </div>

  <!-- ACTIVE ORDERS -->
  <div id="active" class="section" style="display:none;">
    <h3>Active Orders</h3>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Medicine</th>
          <th>Qty</th>
          <th>Address</th>
          <th>Status</th>
          <th>Finish</th>
        </tr>
      </thead>
      <tbody id="activeOrders"></tbody>
    </table>
  </div>

  <!-- HISTORY -->
  <div id="history" class="section" style="display:none;">
    <h3>Order History</h3>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Medicine</th>
          <th>Qty</th>
          <th>Address</th>
          <th>Status</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody id="historyOrders"></tbody>
    </table>
  </div>

  <!-- PROFILE -->
  <div id="profile" class="section" style="display:none;">
    <h3>Pharmacy Profile</h3>
    <p><strong>Name:</strong> City Pharmacy</p>
    <p><strong>Email:</strong> city@pharmacy.com</p>
    <p><strong>Location:</strong> Prishtina</p>
  </div>

</div>

<script>
const BASE_URL = "http://localhost:5183";

/* MENU */
function showSection(id){
  document.querySelectorAll(".section").forEach(s => s.style.display="none");
  document.getElementById(id).style.display="block";
}

function logout(){
  window.location.href = "index.html";
}

/* LOAD REQUESTS */
async function loadRequests(){
  const res = await fetch(`${BASE_URL}/api/requests`);
  const data = await res.json();

  const newT = document.getElementById("newRequests");
  const activeT = document.getElementById("activeOrders");
  const historyT = document.getElementById("historyOrders");

  newT.innerHTML = "";
  activeT.innerHTML = "";
  historyT.innerHTML = "";

  let pending=0, active=0, done=0;

  data.forEach(r => {

    if (r.status === "Pending"){
      pending++;
      newT.innerHTML += `
        <tr>
          <td>${r.id}</td>
          <td>${r.medicineName}</td>
          <td>${r.quantity}</td>
          <td>${r.address}</td>
          <td>${new Date(r.createdAt).toLocaleString()}</td>
          <td>
            <button class="btn btn-accept" onclick="accept(${r.id})">Accept</button>
          </td>
        </tr>`;
    }

    if (r.status === "Accepted"){
      active++;
      activeT.innerHTML += `
        <tr>
          <td>${r.id}</td>
          <td>${r.medicineName}</td>
          <td>${r.quantity}</td>
          <td>${r.address}</td>
          <td class="status-accepted">Accepted</td>
          <td>
            <button class="btn btn-done" onclick="deliver(${r.id})">Delivered</button>
          </td>
        </tr>`;
    }

    if (r.status === "Delivered"){
      done++;
      historyT.innerHTML += `
        <tr>
          <td>${r.id}</td>
          <td>${r.medicineName}</td>
          <td>${r.quantity}</td>
          <td>${r.address}</td>
          <td class="status-delivered">Delivered</td>
          <td>${new Date(r.createdAt).toLocaleString()}</td>
        </tr>`;
    }

  });

  document.getElementById("totalReq").innerText = data.length;
  document.getElementById("pendingReq").innerText = pending;
  document.getElementById("activeReq").innerText = active;
  document.getElementById("doneReq").innerText = done;
}

/* ACCEPT REQUEST */
async function accept(id){
  await fetch(`${BASE_URL}/api/requests/accept/${id}`, { method:"POST" });
  loadRequests();
}

/* DELIVER REQUEST */
async function deliver(id){
  await fetch(`${BASE_URL}/api/requests/deliver/${id}`, { method:"POST" });
  loadRequests();
}

/* AUTO REFRESH */
setInterval(loadRequests, 3000);
loadRequests();
</script>


</body>
</html>
