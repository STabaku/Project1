<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nearby Pharmacies - Emergency Pharmacy</title>

<!-- ICONS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="style.css">
<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root{
  --blue1:#0a58ca;
  --blue2:#1e90ff;
  --blue3:#4facfe;
  --bg:#eef3f8;
  --card:#ffffff;
  --text:#0b1b2b;
  --muted:#6c7a89;
  --success:#28a745;
  --warning:#f5b301;
  --shadow: 0 10px 30px rgba(0,0,0,0.12);
  --radius: 16px;
}
*{ box-sizing:border-box; }
.navbar{
  background: linear-gradient(90deg, #f9f9f9, #ffffff);
  color: #0a58ca;
  padding: 18px 0;
}
.search-box{
  background:white;
  max-width:820px;
  margin:0 auto 20px;
  padding:12px;
  border-radius:18px;
  display:flex;
  gap:12px;
  box-shadow: var(--shadow);
}
.search-box input{
  flex:1;
  border:none;
  font-size:16px;
  padding:10px;
  outline:none;
}
.search-box button{
  background:#28a745;
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
}
.main{
  width:min(1200px, 92%);
  margin:50px auto 60px;
}
.main h2{
  font-size:30px;
  font-weight:800;
  margin-bottom:20px;
  color: #0a58ca;
}
.grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap:26px;
}
.pharmacy-card{
  background:white;
  border-radius:16px;
  box-shadow: var(--shadow);
  padding:22px;
  transition:0.25s;
  position:relative;
}
.pharmacy-card:hover{ transform: translateY(-6px); }
.status{
  position:absolute;
  top:16px;
  right:16px;
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
  font-weight:700;
}
.open{ background: rgba(40,167,69,0.15); color:#0a58ca; }
.closed{ background: rgba(220,53,69,0.15); color:#a11d2d; }
.pharmacy-icon{
  width:70px; height:70px;
  background: linear-gradient(135deg, #1e90ff, #4facfe);
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:32px;
  margin-bottom:14px;
  overflow:hidden;
}
.pharmacy-icon img{
  width:100%; height:100%;
  object-fit:cover;
}
.pharmacy-card h3{ margin:8px 0 4px; font-size:20px; }
.pharmacy-card small{ color:var(--muted); display:block; margin-bottom:8px; }
.details{ font-size:14px; color:var(--muted); margin-bottom:14px; }
.details i{ color: var(--blue2); margin-right:6px; }
.pharmacy-card button{
  background:#0a58ca; color:white;
  border:none; padding:12px; width:100%;
  border-radius:10px; font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar">
  <div class="nav-container">
    <a class="navbar-brand" href="#">
      <img src="assets/logo.png" alt="24/7 Emergency Pharmacy">
    </a>
    <div class="nav-links">
      <a class="nav-link" href="index.html"><i class="fa fa-house"></i> Home</a>
      <a class="nav-link" href="request.html"><i class="fa fa-notes-medical"></i> Request Medicine</a>
      <a class="nav-link" href="pharmacies.html"><i class="fa fa-location-dot"></i> Nearby Pharmacies</a>
          <a class="nav-link" href="profile.html"><i class="fa fa-user"></i> My profile</a>
    
    </div>
  </div>
</nav>

<!-- MAIN -->
<div class="main">

  <!-- SEARCH BAR -->
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search pharmacies by name...">
    <button onclick="filterPharmacies()">
      <i class="fa-solid fa-magnifying-glass"></i> Search
    </button>
  </div>

  <h2>Available Pharmacies Near You</h2>

  <div class="grid" id="pharmacyGrid">
    <!-- Pharmacy cards will be inserted here dynamically -->
  </div>

</div>

<script>
const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";

// ===== PHARMACIES DATA =====
const pharmacies = [
  { key: "city", name: "City Pharmacy", address: "Main Street, Tirana", lat: 41.3275, lng: 19.8189, open: true, image: "assets/citypharmacy.jpg" },
  { key: "healthplus", name: "Health Plus Pharmacy", address: "Bulevardi Zogu I", lat: 41.3350, lng: 19.8050, open: true, image: "assets/healthpluspharmacy.jpg" },
  { key: "vita", name: "Pharmacy Vita", address: "Rruga e Durrësit", lat: 41.3270, lng: 19.8120, open: false, image: "assets/vitapharmacy.jpg" },
  { key: "greencross", name: "Green Cross Pharmacy", address: "Komuna e Parisit", lat: 41.3400, lng: 19.8230, open: true, image: "assets/greencrosspharmacy.jpg" },
  { key: "medicare", name: "Medicare Pharmacy", address: "Rruga Myslym Shyri", lat: 41.3300, lng: 19.8200, open: true, image: "assets/medicarepharmacy.jpg" },
  { key: "family", name: "Family Pharmacy", address: "Rruga e Kavajës", lat: 41.3200, lng: 19.8000, open: true, image: "assets/familypharmacy.jpg" },
  { key: "careplus", name: "Care Plus Pharmacy", address: "Bulevardi Zhan D'Ark", lat: 41.3280, lng: 19.8100, open: false, image: "assets/carepluspharmacy.jpg" },
  { key: "rapid", name: "Rapid Pharmacy", address: "Rruga 28 Nëntori", lat: 41.3360, lng: 19.8070, open: true, image: "assets/rapidpharmacy.jpg" }
];


// ===== HELPER FUNCTION TO CALCULATE DISTANCE =====
function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371; // km
  const dLat = (lat2-lat1)*Math.PI/180;
  const dLon = (lon2-lon1)*Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R*c; // distance in km
}

// ===== RENDER PHARMACIES =====
function renderPharmacies(userLat=null, userLng=null, filter="") {
  const grid = document.getElementById("pharmacyGrid");
  grid.innerHTML = "";

  let filtered = pharmacies.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));

  // calculate distance if user location is available
  if(userLat !== null && userLng !== null){
    filtered.forEach(p => p.distanceVal = getDistance(userLat, userLng, p.lat, p.lng));
    filtered.sort((a,b) => a.distanceVal - b.distanceVal);
  }

  filtered.forEach(p => {
    const card = document.createElement("div");
    card.className = "pharmacy-card";
    card.innerHTML = `
      <div class="status ${p.open ? 'open' : 'closed'}">${p.open ? 'Open' : 'Closed'}</div>
      <div class="pharmacy-icon">
        <img src="${p.image}" alt="${p.name}">
      </div>
      <h3>${p.name}</h3>
      <small>${p.address}</small>
      ${userLat !== null ? `<div class="details"><p><i class="fa-solid fa-location-dot"></i>${p.distanceVal.toFixed(1)} km away</p></div>` : ""}
 ${isLoggedIn 
  ? `<button onclick="window.location.href='browse.html?pharmacy=${p.key}'">View Pharmacy</button>` 
  : `<button onclick="alert('Please log in to view this pharmacy.')" style="background:#ccc; cursor:not-allowed;">Login to view</button>`
}


    `;
    grid.appendChild(card);
  });
}

// ===== FILTER FUNCTION =====
function filterPharmacies(){
  const val = document.getElementById("searchInput").value.trim();
  // try to get geolocation
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos => {
      renderPharmacies(pos.coords.latitude, pos.coords.longitude, val);
    }, () => {
      renderPharmacies(null,null,val);
    });
  } else {
    renderPharmacies(null,null,val);
  }
}

// ===== INITIAL RENDER =====
if(navigator.geolocation){
  navigator.geolocation.getCurrentPosition(pos => {
    renderPharmacies(pos.coords.latitude, pos.coords.longitude);
  }, () => {
    renderPharmacies();
  });
} else {
  renderPharmacies();
}
</script>
<script src="script.js"></script>
</body>
</html>
